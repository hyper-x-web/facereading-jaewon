<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 관상가 - 한국 전통 관상 분석</title>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&family=Yeon+Sung&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f4f0e6; /* 한지 색상 */
            --text-color: #2c2c2c; /* 먹물 색상 */
            --accent-red: #a93226; /* 인주 색상 */
            --accent-blue: #2471a3;
            --accent-gold: #b7950b;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Nanum Myeongjo', serif;
            background-color: var(--bg-color);
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E");
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- UI Components --- */
        .container {
            width: 100%;
            max-width: 800px;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        h1 {
            font-family: 'Yeon Sung', cursive;
            font-size: 3rem;
            margin-bottom: 10px;
            color: var(--text-color);
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }

        .subtitle {
            font-size: 1.1rem;
            margin-bottom: 30px;
            color: #555;
            border-top: 1px solid #ccc;
            border-bottom: 1px solid #ccc;
            display: inline-block;
            padding: 5px 20px;
        }

        .btn {
            background-color: var(--text-color);
            color: var(--bg-color);
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-family: 'Nanum Myeongjo', serif;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .btn:hover {
            background-color: var(--accent-red);
            transform: translateY(-2px);
        }

        .btn-retry {
            background-color: #fff;
            color: var(--text-color);
            border: 2px solid var(--text-color);
            margin-top: 20px;
        }

        /* --- Screens --- */
        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            animation: fadeIn 0.5s ease-in-out;
        }

        .screen.active {
            display: flex;
        }

        /* --- Camera Area --- */
        .camera-wrapper {
            position: relative;
            width: 100%;
            max-width: 500px;
            aspect-ratio: 3/4;
            background: #000;
            border: 4px double var(--text-color);
            margin-bottom: 20px;
            overflow: hidden;
            border-radius: 8px;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* 거울 모드 */
        }

        #captured-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
            display: none;
        }

        /* Scan Overlay */
        .scan-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: none;
        }
        
        .scan-line {
            width: 100%;
            height: 2px;
            background: var(--accent-red);
            box-shadow: 0 0 10px var(--accent-red);
            position: absolute;
            top: 0;
            animation: scan 2s infinite linear;
        }

        .face-guide {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60%;
            height: 40%;
            border: 2px dashed rgba(255,255,255,0.5);
            border-radius: 50%;
        }

        /* Countdown */
        #countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 8rem;
            color: white;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(0,0,0,0.8);
            display: none;
            z-index: 10;
        }

        /* Flash Effect */
        #flash {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 20;
        }

        /* --- Loading --- */
        .loader {
            font-size: 1.5rem;
            margin-top: 20px;
        }
        .dots::after {
            content: '.';
            animation: dots 1.5s steps(5, end) infinite;
        }

        /* --- Result Section --- */
        .result-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            gap: 20px;
        }

        .result-image-box {
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            border: 4px double var(--text-color);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .result-image-box img {
            width: 100%;
            display: block;
            transform: scaleX(-1);
        }

        .result-paper {
            background: rgba(255, 255, 255, 0.6);
            padding: 30px;
            border-radius: 4px;
            border: 1px solid rgba(0,0,0,0.1);
            text-align: left;
            position: relative;
        }

        .seal {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 60px;
            height: 60px;
            border: 3px solid var(--accent-red);
            color: var(--accent-red);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-family: 'Yeon Sung', cursive;
            font-size: 1.2rem;
            transform: rotate(-15deg);
            opacity: 0.8;
        }

        .result-section {
            margin-bottom: 20px;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 15px;
        }

        .result-section:last-child {
            border-bottom: none;
        }

        .result-title {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--accent-blue);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .result-title::before {
            content: '✦';
            margin-right: 8px;
            color: var(--text-color);
        }

        .result-desc {
            font-size: 1rem;
            line-height: 1.6;
            word-break: keep-all;
        }

        /* Media Queries */
        @media (min-width: 768px) {
            .result-container {
                flex-direction: row;
                align-items: flex-start;
            }
            .result-image-box {
                flex: 1;
            }
            .result-paper {
                flex: 2;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes scan {
            0% { top: 0%; }
            50% { top: 100%; }
            100% { top: 0%; }
        }
        @keyframes dots {
            0%, 20% { color: rgba(0,0,0,0); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);}
            40% { color: #333; text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);}
            60% { text-shadow: .25em 0 0 #333, .5em 0 0 rgba(0,0,0,0);}
            80%, 100% { text-shadow: .25em 0 0 #333, .5em 0 0 #333;}
        }
        @keyframes flashAnim {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }

    </style>
</head>
<body>

    <div class="container">
        <h1>AI 관상가</h1>
        <div class="subtitle">천기누설(天機漏洩) - 당신의 운명을 비추다</div>

        <!-- 1. Intro Screen -->
        <div id="intro-screen" class="screen active">
            <div style="margin: 40px 0; font-size: 1.1rem; line-height: 1.8;">
                <p>얼굴은 마음의 거울이요, 운명의 지도라 했습니다.</p>
                <p>최첨단 기술로 당신의 오관(五官)을 분석하여</p>
                <p>초년, 중년, 말년의 운세와 재물, 연애운을 보아드립니다.</p>
            </div>
            <button class="btn" onclick="startCamera()">관상 보기</button>
        </div>

        <!-- 2. Camera Screen -->
        <div id="camera-screen" class="screen">
            <div class="camera-wrapper">
                <video id="video" autoplay playsinline></video>
                <canvas id="canvas" style="display:none;"></canvas> <!-- Hidden canvas for capture -->
                <div class="scan-overlay" id="scan-overlay">
                    <div class="scan-line"></div>
                    <div class="face-guide"></div>
                </div>
                <div id="countdown"></div>
                <div id="flash"></div>
            </div>
            <p style="margin-bottom: 20px; color: #666;">정면을 응시하고 조명 밝은 곳에서 찍어주세요.</p>
            <button class="btn" onclick="takePhoto()">촬영 하기</button>
        </div>

        <!-- 3. Loading Screen -->
        <div id="loading-screen" class="screen">
            <div class="camera-wrapper" style="border-color: var(--accent-gold);">
                 <img id="analyzing-img" src="" alt="analyzing" style="width:100%; height:100%; object-fit:cover; transform: scaleX(-1);">
                 <div class="scan-overlay" style="display:block;">
                     <div class="scan-line" style="background: var(--accent-gold); box-shadow: 0 0 10px var(--accent-gold);"></div>
                 </div>
            </div>
            <div class="loader">
                오관(五官)을 살피고 기색(氣色)을 읽는 중<span class="dots"></span>
            </div>
        </div>

        <!-- 4. Result Screen -->
        <div id="result-screen" class="screen">
            <div class="result-container">
                <div class="result-image-box">
                    <img id="result-img" src="" alt="Captured Face">
                </div>
                <div class="result-paper">
                    <div class="seal">관상</div>
                    <div id="result-content">
                        <!-- JS generated content goes here -->
                    </div>
                </div>
            </div>
            <button class="btn btn-retry" onclick="resetApp()">다시 찍기</button>
        </div>
    </div>

    <script>
        // --- State & DOM Elements ---
        const introScreen = document.getElementById('intro-screen');
        const cameraScreen = document.getElementById('camera-screen');
        const loadingScreen = document.getElementById('loading-screen');
        const resultScreen = document.getElementById('result-screen');
        
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const countdownEl = document.getElementById('countdown');
        const flashEl = document.getElementById('flash');
        
        const analyzingImg = document.getElementById('analyzing-img');
        const resultImg = document.getElementById('result-img');
        const resultContent = document.getElementById('result-content');

        let stream = null;

        // --- Camera Functions ---
        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "user", width: { ideal: 640 }, height: { ideal: 480 } }, 
                    audio: false 
                });
                video.srcObject = stream;
                
                switchScreen('camera');
                document.getElementById('scan-overlay').style.display = 'block';
            } catch (err) {
                alert("카메라 권한이 필요합니다. 설정에서 허용해주세요.\n오류: " + err.message);
            }
        }

        function takePhoto() {
            // Start Countdown
            let count = 3;
            countdownEl.style.display = 'block';
            countdownEl.innerText = count;

            const timer = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownEl.innerText = count;
                } else {
                    clearInterval(timer);
                    countdownEl.style.display = 'none';
                    capture();
                }
            }, 1000);
        }

        function capture() {
            // Flash Effect
            flashEl.style.animation = 'flashAnim 0.3s ease-out';
            setTimeout(() => { flashEl.style.animation = 'none'; }, 300);

            // Draw to Canvas
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Get Image Data
            const dataUrl = canvas.toDataURL('image/png');
            analyzingImg.src = dataUrl;
            resultImg.src = dataUrl;

            // Stop Camera
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }

            // Move to Analysis
            switchScreen('loading');
            
            // Simulate Analysis Time
            setTimeout(() => {
                generatePhysiognomy(context.getImageData(0, 0, canvas.width, canvas.height));
                switchScreen('result');
            }, 3000);
        }

        function switchScreen(screenName) {
            introScreen.classList.remove('active');
            cameraScreen.classList.remove('active');
            loadingScreen.classList.remove('active');
            resultScreen.classList.remove('active');

            if (screenName === 'intro') introScreen.classList.add('active');
            else if (screenName === 'camera') cameraScreen.classList.add('active');
            else if (screenName === 'loading') loadingScreen.classList.add('active');
            else if (screenName === 'result') resultScreen.classList.add('active');
        }

        function resetApp() {
            resultImg.src = "";
            switchScreen('intro');
        }

        // --- Physiognomy Logic (Simulation) ---
        // 실제 AI 모델 대신, 픽셀 데이터의 밝기나 랜덤 시드를 활용하여 
        // 매번 다르지만 같은 사진엔 같은 결과가 나오도록 시뮬레이션
        
        const physiognomyData = {
            early: [
                "이마가 넓고 시원하니 초년에 학업운이 따르고 부모의 덕을 볼 상이로다.",
                "이마가 다소 좁으나 빛이 나니, 자수성가하여 일찍이 세상에 이름을 알릴 운명이니라.",
                "이마의 기색이 맑아 총명하며, 20대에 귀인을 만나 큰 기회를 얻을 상이로다.",
                "초년에는 다소 고생이 따를 수 있으나, 이는 훗날 큰 그릇이 되기 위한 밑거름이 될 것이니라."
            ],
            middle: [
                "눈빛이 형형하고 콧대가 바르니, 30대 이후 사회적 지위가 급격히 상승할 상이로다.",
                "코가 두툼하고 힘이 있으니 중년에 재물이 모이고 사람이 따를 운세로다.",
                "눈매가 부드러워 인덕이 많으니, 40대에 이르러 주변의 도움으로 안정을 찾을 상이로다.",
                "관골(광대)이 적당히 솟아 추진력이 좋으니, 중년에 사업이나 일에서 큰 성과를 거둘 것이니라."
            ],
            late: [
                "턱이 둥글고 후덕하니 말년에 자식이 효도하고 재물이 마르지 않을 상이로다.",
                "입꼬리가 올라가 있어 웃음이 끊이지 않으니, 노후가 평안하고 건강할 운명이니라.",
                "하관이 단단하여 의지가 굳건하니, 늦은 나이까지 현역에서 활동하며 존경받을 상이로다.",
                "입술이 도톰하고 턱선이 살아있으니 말년에 명예를 얻고 편안히 쉴 운세로다."
            ],
            love: [
                "눈가에 도화살이 살짝 비치니 이성에게 인기가 많으나, 구설수를 조심해야 할 상이로다.",
                "눈꼬리가 처져 선한 인상을 주니, 다정다감한 연인을 만나 사랑받을 운명이니라.",
                "애교살이 도톰하니 정이 많고 표현이 좋아, 연애가 끊이지 않고 즐거울 상이로다.",
                "눈빛이 깊고 그윽하여 한 사람만을 깊게 사랑하는 지고지순한 사랑을 할 운세로다."
            ],
            marriage: [
                "얼굴의 좌우 균형이 절묘하니, 지혜롭고 현명한 배우자를 만나 가정이 화목할 상이로다.",
                "인당(미간)이 넓고 깨끗하니 배우자 복이 있어 결혼 후 일이 더 잘 풀릴 운명이니라.",
                "이목구비가 조화로우니 성격이 원만한 짝을 만나 평생 친구처럼 지낼 상이로다.",
                "부부궁이 맑고 윤기가 흐르니, 결혼을 통해 재산이 불어나고 안정을 찾을 운세로다."
            ],
            wealth: [
                "콧망울(준두)이 꽉 차있고 콧구멍이 보이지 않으니, 재물이 들어오면 절대 나가지 않을 '금고'의 상이로다.",
                "코가 얼굴의 중심을 잘 잡고 있으니, 정직하게 번 돈으로 큰 부를 축적할 상이로다.",
                "귀가 크고 귓볼이 두툼하니 재복을 타고났으며, 평생 돈 걱정 없이 살 운명이니라.",
                "재백궁이 밝게 빛나니 횡재수가 있으며, 투자나 사업에서 큰 이익을 볼 상이로다."
            ],
            children: [
                "눈 밑 와잠(눈물주머니)이 도톰하고 색이 맑으니, 귀한 자식을 두어 가문을 빛낼 상이로다.",
                "인중이 깊고 또렷하니 자식 복이 많고, 자녀들이 건강하고 바르게 자랄 운세로다.",
                "눈동자가 검고 맑으니 자식들이 총명하여 학문으로 대성할 상이로다.",
                "자녀궁이 깨끗하니 늦게라도 효자, 효녀를 얻어 말년이 외롭지 않을 운명이니라."
            ]
        };

        function generatePhysiognomy(imageData) {
            // Pseudo-random generation based on image data sum to be deterministic for the same photo
            // This simulates "Analyzing the specific face"
            let pixelSum = 0;
            const data = imageData.data;
            for(let i = 0; i < data.length; i += 100) { // Sample pixels
                pixelSum += data[i];
            }
            
            // Helper to get random index based on seed
            const getIndex = (seed, length) => Math.floor((seed % 100) / 100 * length);

            // Generate HTML
            let html = '';
            
            // 1. 초년운 (상정)
            html += `<div class="result-section"><div class="result-title">초년운 (이마)</div>`;
            html += `<div class="result-desc">${physiognomyData.early[getIndex(pixelSum, 4)]}</div></div>`;
            
            // 2. 중년운 (중정)
            html += `<div class="result-section"><div class="result-title">중년운 (눈과 코)</div>`;
            html += `<div class="result-desc">${physiognomyData.middle[getIndex(pixelSum + 15, 4)]}</div></div>`;
            
            // 3. 말년운 (하정)
            html += `<div class="result-section"><div class="result-title">말년운 (입과 턱)</div>`;
            html += `<div class="result-desc">${physiognomyData.late[getIndex(pixelSum + 30, 4)]}</div></div>`;
            
            // 4. 연애운
            html += `<div class="result-section"><div class="result-title">연애운</div>`;
            html += `<div class="result-desc">${physiognomyData.love[getIndex(pixelSum * 2, 4)]}</div></div>`;

            // 5. 결혼운
            html += `<div class="result-section"><div class="result-title">결혼운</div>`;
            html += `<div class="result-desc">${physiognomyData.marriage[getIndex(pixelSum + 77, 4)]}</div></div>`;

            // 6. 금전운
            html += `<div class="result-section"><div class="result-title">금전운 (재백궁)</div>`;
            html += `<div class="result-desc">${physiognomyData.wealth[getIndex(pixelSum / 3, 4)]}</div></div>`;

            // 7. 자식운
            html += `<div class="result-section"><div class="result-title">자식운</div>`;
            html += `<div class="result-desc">${physiognomyData.children[getIndex(pixelSum - 50, 4)]}</div></div>`;

            resultContent.innerHTML = html;
        }

    </script>
</body>
</html>